<?php

class ActivateModuleTestCase extends TestCase {

    function ActivateModuleTestCase($moduleId) {
	$this->_moduleId = $moduleId;
    }

    function getDescription() {
	global $gallery;
	list ($ret, $moduleStatus) = GalleryCoreApi::fetchPluginStatus('module');
	if ($ret->isError()) {
	    $status = 'error';
	} else {
	    if (empty($moduleStatus[$this->_moduleId]['active'])) {
		$status = 'inactive';
	    } else {
		$status = 'active';
	    }
	}
	return "Activate the $this->_moduleId module (currently $status)";
    }

    function testStart() {
	global $gallery;

	list ($ret, $moduleStatus) = GalleryCoreApi::fetchPluginStatus('module');
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}
	if (empty($moduleStatus[$this->_moduleId]['active'])) {
	    list ($ret, $module) = GalleryCoreApi::loadPlugin('module', $this->_moduleId);
	    if ($ret->isError()) {
		return $ret->wrap(__FILE__, __LINE__);
	    }

	    list ($ret, $redirect) = $module->activate();
	    if ($ret->isError()) {
		return $ret->wrap(__FILE__, __LINE__);
	    }
	} else {
	    if ($gallery->getDebug()) {
		$gallery->debug($this->_moduleId . ' is already activated.');
	    }
	}

	return GalleryStatus::success();
    }
}

?>
