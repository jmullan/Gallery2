<?php
/*
 * $RCSfile$
 *
 * Gallery - a web based photo album viewer and editor
 * Copyright (C) 2000-2003 Bharat Mediratta
 * 
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or (at
 * your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
 */
/**
 * @version $Revision$ $Date$
 * @package Exif
 * @author Bharat Mediratta <bharat@menalto.com>
 */

/**
 * Summary EXIF setting
 */
define('EXIF_SUMMARY', 1);

/**
 * Detailed EXIF setting
 */
define('EXIF_DETAILED', 2);

/**
 * A helper class for the EXIF module.
 *
 * @package Exif
 * @subpackage Classes
 */
class ExifHelper {

    /**
     * Reset the given view mode back to its default settings
     *
     * @param int the view mode
     * @return object GalleryStatus a status code
     * @static
     */
    function setDefaultProperties($viewMode) {
	switch($viewMode) {
	case EXIF_SUMMARY:
	    /*
	     * This is an initial install. Make sure that we have some
	     * reasonable defaults.
	     */
	    $properties[] = 'IFD0.Make';
	    $properties[] = 'IFD0.Model';
	    $properties[] = 'SubIFD.ApertureValue';
	    $properties[] = 'SubIFD.ColorSpace';
	    $properties[] = 'SubIFD.ExposureBiasValue';
	    $properties[] = 'SubIFD.ExposureProgram';
	    $properties[] = 'SubIFD.ExposureTime';
	    $properties[] = 'SubIFD.FNumber';
	    $properties[] = 'SubIFD.Flash';
	    $properties[] = 'SubIFD.FocalLength';
	    $properties[] = 'SubIFD.ISOSpeedRatings';
	    $properties[] = 'SubIFD.MeteringMode';
	    $properties[] = 'SubIFD.ShutterSpeedValue';
	    $properties[] = 'IFD0.DateTime';
	    break;

	case EXIF_DETAILED:
	    $properties[] = 'IFD0.Make';
	    $properties[] = 'IFD0.Model';
	    $properties[] = 'SubIFD.ApertureValue';
	    $properties[] = 'SubIFD.ColorSpace';
	    $properties[] = 'SubIFD.ExposureBiasValue';
	    $properties[] = 'SubIFD.ExposureProgram';
	    $properties[] = 'SubIFD.ExposureTime';
	    $properties[] = 'SubIFD.FNumber';
	    $properties[] = 'SubIFD.Flash';
	    $properties[] = 'SubIFD.FocalLength';
	    $properties[] = 'SubIFD.ISOSpeedRatings';
	    $properties[] = 'SubIFD.MeteringMode';
	    $properties[] = 'SubIFD.ShutterSpeedValue';
	    $properties[] = 'IFD0.DateTime';
	    $properties[] = 'IFD0.ImageType';
	    $properties[] = 'IFD0.Orientation';
	    $properties[] = 'IFD0.PhotoshopSettings';
	    $properties[] = 'IFD0.ResolutionUnit';
	    $properties[] = 'IFD0.xResolution';
	    $properties[] = 'IFD0.yResolution';
	    $properties[] = 'IFD1.Compression';
	    $properties[] = 'SubIFD.BrightnessValue';
	    $properties[] = 'SubIFD.Contrast';
	    $properties[] = 'SubIFD.ExposureMode';
	    $properties[] = 'SubIFD.FlashEnergy';
	    $properties[] = 'SubIFD.Saturation';
	    $properties[] = 'SubIFD.SceneType';
	    $properties[] = 'SubIFD.Sharpness';
	    $properties[] = 'SubIFD.SubjectDistance';
	    break;

	default:
	    return GalleryStatus::error(ERROR_BAD_PARAMETER, __FILE__, __LINE__);
	}

	$ret = ExifPropertiesMap::setProperties($viewMode, $properties);
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}

	return GalleryStatus::success();
    }

    /**
     * Return the EXIF data for a specific view and file 
     *
     * @param string the path to the file
     * @param int the view mode
     * @return array object GalleryStatus a status code
     *               array title/value pairs
     * @static
     */
    function getExifData($path, $viewMode) {
	global $gallery;
	require_once(dirname(__FILE__) . '/../lib/exifer/exif.inc');

	$exifKeys = ExifHelper::getExifKeys();
	$rawExifData = read_exif_data_raw($path, false);
	$gallery->debug(str_replace("\0", '', print_r($rawExifData, 1)));

	$results = array();
	list ($ret, $properties) = ExifPropertiesMap::getProperties($viewMode);
	if ($ret->isError()) {
	    return array($ret->wrap(__FILE__, __LINE__), null);
	}
	foreach ($properties as $property) {
	    $value = ExifHelper::_getValue($rawExifData, explode('.', $exifKeys[$property][0]));
	    if (isset($value)) {
		$results[] = array('title' => $exifKeys[$property][1],
				   'value' => $value);
	    }
	}

	return array(GalleryStatus::success(), $results);
    }

    /**
     * Retrieve a single value by path from a nested associative array.
     * The data source is an array like this:
     *
     * foo =>
     *   bar => (a => 1, b => 2, c => 3)
     *   baz => (d => 4, e => 5, f => 6)
     *
     * the key path is an array like this:
     *
     * (foo, bar, d)
     *
     * the resulting value would be "4"
     * 
     * @param array the data source
     * @param array the key path
     * @return array object GalleryStatus a status code
     *               string value
     * @static
     */
    function _getValue(&$source, $keyPath) {
	$key = array_shift($keyPath);
	if (!isset($source[$key])) {
	    return null;
	}
	
	if (empty($keyPath)) {
	    return str_replace("\0", '', $source[$key]);
	} else {
	    return ExifHelper::_getValue($source[$key], $keyPath);
	}
    }

    /**
     * Return the EXIF keys that we know about (from Exifer).
     *
     * The resulting array is of the form:
     *
     *   logical exif property => (physical exif property, internationalized title, group)
     *   logical exif property => (physical exif property, internationalized title, group)
     *
     * The logical exif properties are unique and have some correlation to the
     * physical property, but have been changed for our convenience.  The physical
     * exif property is the actual exif property name (as reported by Exifer).  The group
     * is an internationalized name of a group like "General Properties", etc.
     *
     * @return array exif keys
     */
    function getExifKeys() {
	global $gallery;
	static $data;
	
	if (empty($data)) {
	    /* -- GENERAL -- */
	    $general = $gallery->i18n('General Properties');
	    $data['IFD0.ACDComment'] = array('IFD0.ACDComment', $gallery->i18n('ACD Comment'), $general);
	    $data['IFD0.ImageType'] = array('IFD0.ImageType', $gallery->i18n('Image Type'), $general);
	    $data['IFD0.PhotometricInterpret'] = array('IFD0.PhotometricInterpret', $gallery->i18n('Photometric Interpret'), $general);
	    $data['IFD0.ImageDescription'] = array('IFD0.ImageDescription', $gallery->i18n('Image Description'), $general);
	    $data['IFD0.Make'] = array('IFD0.Make', $gallery->i18n('Make'), $general);
	    $data['IFD0.Model'] = array('IFD0.Model', $gallery->i18n('Model'), $general);
	    $data['IFD0.Orientation'] = array('IFD0.Orientation', $gallery->i18n('Orientation'), $general);
	    $data['IFD0.SamplePerPixel'] = array('IFD0.SamplePerPixel', $gallery->i18n('Sample Per Pixel'), $general);
	    $data['IFD0.xResolution'] = array('IFD0.xResolution', $gallery->i18n('X Resolution'), $general);
	    $data['IFD0.yResolution'] = array('IFD0.yResolution', $gallery->i18n('Y Resolution'), $general);
	    $data['IFD0.ResolutionUnit'] = array('IFD0.ResolutionUnit', $gallery->i18n('Resolution Unit'), $general);
	    $data['IFD0.PlanarConfig'] = array('IFD0.PlanarConfig', $gallery->i18n('Planar Config'), $general);
	    $data['IFD0.Software'] = array('IFD0.Software', $gallery->i18n('Software'), $general);
	    $data['IFD0.DateTime'] = array('IFD0.DateTime', $gallery->i18n('Date/Time'), $general);
	    $data['IFD0.Artist'] = array('IFD0.Artist', $gallery->i18n('Artist'), $general);
	    $data['IFD0.WhitePoint'] = array('IFD0.WhitePoint', $gallery->i18n('White Point'), $general);
	    $data['IFD0.PrimaryChromaticities'] = array('IFD0.PrimaryChromaticities', $gallery->i18n('Primary Chromaticities'), $general);
	    $data['IFD0.YCbCrCoefficients'] = array('IFD0.YCbCrCoefficients', $gallery->i18n('Y/Cb/Cr Coefficients'), $general);
	    $data['IFD0.YCbCrPositioning'] = array('IFD0.YCbCrPositioning', $gallery->i18n('Y/Cb/Cr Positioning'), $general);
	    $data['IFD0.ReferenceBlackWhite'] = array('IFD0.ReferenceBlackWhite', $gallery->i18n('Reference Black/White'), $general);
	    $data['IFD0.Copyright'] = array('IFD0.Copyright', $gallery->i18n('Copyright'), $general);
	    $data['IFD0.PhotoshopSettings'] = array('IFD0.PhotoshopSettings', $gallery->i18n('Photoshop Settings'), $general);
	    $data['IFD0.UserCommentOld'] = array('IFD0.UserCommentOld', $gallery->i18n('User Comment (Old)'), $general);
	    $data['IFD0.ExifOffset'] = array('IFD0.ExifOffset', $gallery->i18n('Exif Offset'), $general);
	    $data['SubIFD.ExposureTime'] = array('SubIFD.ExposureTime', $gallery->i18n('Exposure Time'), $general);
	    $data['SubIFD.FNumber'] = array('SubIFD.FNumber', $gallery->i18n('F Number'), $general);
	    $data['SubIFD.ExposureProgram'] = array('SubIFD.ExposureProgram', $gallery->i18n('Exposure Program'), $general);
	    $data['SubIFD.SpectralSensitivity'] = array('SubIFD.SpectralSensitivity', $gallery->i18n('Spectral Sensitivity'), $general);
	    $data['SubIFD.ISOSpeedRatings'] = array('SubIFD.ISOSpeedRatings', $gallery->i18n('ISO Speed Ratings'), $general);
	    $data['SubIFD.ExifVersion'] = array('SubIFD.ExifVersion', $gallery->i18n('Exif Version'), $general);
	    $data['SubIFD.DateTimeOriginal'] = array('SubIFD.DateTimeOriginal', $gallery->i18n('Date/Time (Original)'), $general);
	    $data['SubIFD.DateTimeDigitized'] = array('SubIFD.DateTimeDigitized', $gallery->i18n('Date/Time (Digitized)'), $general);
	    $data['SubIFD.ComponentsConfiguration'] = array('SubIFD.ComponentsConfiguration', $gallery->i18n('Components Configuration'), $general);
	    $data['SubIFD.CompressedBitsPerPixel'] = array('SubIFD.CompressedBitsPerPixel', $gallery->i18n('Compressed Bits Per Pixel'), $general);
	    $data['SubIFD.ShutterSpeedValue'] = array('SubIFD.ShutterSpeedValue', $gallery->i18n('Shutter Speed Value'), $general);
	    $data['SubIFD.ApertureValue'] = array('SubIFD.ApertureValue', $gallery->i18n('Aperture Value'), $general);
	    $data['SubIFD.BrightnessValue'] = array('SubIFD.BrightnessValue', $gallery->i18n('Brightness Value'), $general);
	    $data['SubIFD.ExposureBiasValue'] = array('SubIFD.ExposureBiasValue', $gallery->i18n('Exposure Bias Value'), $general);
	    $data['SubIFD.MaxApertureValue'] = array('SubIFD.MaxApertureValue', $gallery->i18n('Max Aperture Value'), $general);
	    $data['SubIFD.SubjectDistance'] = array('SubIFD.SubjectDistance', $gallery->i18n('Subject Distance'), $general);
	    $data['SubIFD.MeteringMode'] = array('SubIFD.MeteringMode', $gallery->i18n('Metering Mode'), $general);
	    $data['SubIFD.LightSource'] = array('SubIFD.LightSource', $gallery->i18n('Light Source'), $general);
	    $data['SubIFD.Flash'] = array('SubIFD.Flash', $gallery->i18n('Flash'), $general);
	    $data['SubIFD.FocalLength'] = array('SubIFD.FocalLength', $gallery->i18n('Focal Length'), $general);
	    $data['SubIFD.ImageHistory'] = array('SubIFD.ImageHistory', $gallery->i18n('Image History'), $general);
	    $data['SubIFD.UserComment'] = array('SubIFD.UserComment', $gallery->i18n('User Comment'), $general);
	    $data['SubIFD.SubsecTime'] = array('SubIFD.SubsecTime', $gallery->i18n('Subsec Time'), $general);
	    $data['SubIFD.SubsecTimeOriginal'] = array('SubIFD.SubsecTimeOriginal', $gallery->i18n('Subsec Time (Original)'), $general);
	    $data['SubIFD.SubsecTimeDigitized'] = array('SubIFD.SubsecTimeDigitized', $gallery->i18n('Subsec Time (Digitized)'), $general);
	    $data['SubIFD.FlashPixVersion'] = array('SubIFD.FlashPixVersion', $gallery->i18n('Flash Pix Version'), $general);
	    $data['SubIFD.ColorSpace'] = array('SubIFD.ColorSpace', $gallery->i18n('Color Space'), $general);
	    $data['SubIFD.ExifImageWidth'] = array('SubIFD.ExifImageWidth', $gallery->i18n('Exif Image Width'), $general);
	    $data['SubIFD.ExifImageHeight'] = array('SubIFD.ExifImageHeight', $gallery->i18n('Exif Image Height'), $general);
	    $data['SubIFD.RelatedSoundFile'] = array('SubIFD.RelatedSoundFile', $gallery->i18n('Related Sound File'), $general);
	    $data['SubIFD.ExifInteroperabilityOffset'] = array('SubIFD.ExifInteroperabilityOffset', $gallery->i18n('Exif Interoperability Offset'), $general);
	    $data['SubIFD.SpacialFreqResponse'] = array('SubIFD.SpacialFreqResponse', $gallery->i18n('Spacial Freq Response'), $general);
	    $data['SubIFD.FlashEnergy'] = array('SubIFD.FlashEnergy', $gallery->i18n('Flash Energy'), $general);
	    $data['SubIFD.FocalPlaneXResolution'] = array('SubIFD.FocalPlaneXResolution', $gallery->i18n('Focal Plane X Resolution'), $general);
	    $data['SubIFD.FocalPlaneYResolution'] = array('SubIFD.FocalPlaneYResolution', $gallery->i18n('Focal Plane Y Resolution'), $general);
	    $data['SubIFD.FocalPlaneResolutionUnit'] = array('SubIFD.FocalPlaneResolutionUnit', $gallery->i18n('Focal Plane Resolution Unit'), $general);
	    $data['SubIFD.SubjectLocation'] = array('SubIFD.SubjectLocation', $gallery->i18n('Subject Location'), $general);
	    $data['SubIFD.ExposureIndex'] = array('SubIFD.ExposureIndex', $gallery->i18n('Exposure Index'), $general);
	    $data['SubIFD.SensingMethod'] = array('SubIFD.SensingMethod', $gallery->i18n('Sensing Method'), $general);
	    $data['SubIFD.FileSource'] = array('SubIFD.FileSource', $gallery->i18n('File Source'), $general);
	    $data['SubIFD.SceneType'] = array('SubIFD.SceneType', $gallery->i18n('Scene Type'), $general);
	    $data['SubIFD.CustomerRender'] = array('SubIFD.CustomerRender', $gallery->i18n('Customer Render'), $general);
	    $data['SubIFD.ExposureMode'] = array('SubIFD.ExposureMode', $gallery->i18n('Exposure Mode'), $general);
	    $data['SubIFD.WhiteBalance'] = array('SubIFD.WhiteBalance', $gallery->i18n('White Balance'), $general);
	    $data['SubIFD.DigitalZoomRatio'] = array('SubIFD.DigitalZoomRatio', $gallery->i18n('Digital Zoom Ratio'), $general);
	    $data['SubIFD.SceneCaptureMode'] = array('SubIFD.SceneCaptureMode', $gallery->i18n('Scene Capture Mode'), $general);
	    $data['SubIFD.GainControl'] = array('SubIFD.GainControl', $gallery->i18n('Gain Control'), $general);
	    $data['SubIFD.Contrast'] = array('SubIFD.Contrast', $gallery->i18n('Contrast'), $general);
	    $data['SubIFD.Saturation'] = array('SubIFD.Saturation', $gallery->i18n('Saturation'), $general);
	    $data['SubIFD.Sharpness'] = array('SubIFD.Sharpness', $gallery->i18n('Sharpness'), $general);
	    $data['InteroperabilityIFD.InteroperabilityIndex'] = array('InteroperabilityIFD.InteroperabilityIndex', $gallery->i18n('Interoperability Index'), $general);
	    $data['InteroperabilityIFD.InteroperabilityVersion'] = array('InteroperabilityIFD.InteroperabilityVersion', $gallery->i18n('Interoperability Version'), $general);
	    $data['InteroperabilityIFD.RelatedImageFileFormat'] = array('InteroperabilityIFD.RelatedImageFileFormat', $gallery->i18n('Related Image File Format'), $general);
	    $data['InteroperabilityIFD.RelatedImageWidth'] = array('InteroperabilityIFD.RelatedImageWidth', $gallery->i18n('Related Image Width'), $general);
	    $data['InteroperabilityIFD.RelatedImageLength'] = array('InteroperabilityIFD.RelatedImageLength', $gallery->i18n('Related Image Length'), $general);
	    $data['IFD1.ImageWidth'] = array('IFD1.ImageWidth', $gallery->i18n('Image Width'), $general);
	    $data['IFD1.ImageLength'] = array('IFD1.ImageLength', $gallery->i18n('Image Length'), $general);
	    $data['IFD1.BitsPerSample'] = array('IFD1.BitsPerSample', $gallery->i18n('Bits Per Sample'), $general);
	    $data['IFD1.Compression'] = array('IFD1.Compression', $gallery->i18n('Compression'), $general);
	    $data['IFD1.PhotometricInterpretation'] = array('IFD1.PhotometricInterpretation', $gallery->i18n('Photometric Interpretation'), $general);
	    $data['IFD1.ThumbnailDescription'] = array('IFD1.ThumbnailDescription', $gallery->i18n('Thumbnail Description'), $general);
	    $data['IFD1.ThumbnailMake'] = array('IFD1.ThumbnailMake', $gallery->i18n('Thumbnail Make'), $general);
	    $data['IFD1.ThumbnailModel'] = array('IFD1.ThumbnailModel', $gallery->i18n('Thumbnail Model'), $general);
	    $data['IFD1.StripOffsets'] = array('IFD1.StripOffsets', $gallery->i18n('Strip Offsets'), $general);
	    $data['IFD1.ThumbnailOrientation'] = array('IFD1.ThumbnailOrientation', $gallery->i18n('Thumbnail Orientation'), $general);
	    $data['IFD1.SamplesPerPixel'] = array('IFD1.SamplesPerPixel', $gallery->i18n('Samples Per Pixel'), $general);
	    $data['IFD1.RowsPerStrip'] = array('IFD1.RowsPerStrip', $gallery->i18n('Rows Per Strip'), $general);
	    $data['IFD1.StripByteCounts'] = array('IFD1.StripByteCounts', $gallery->i18n('Strip Byte Counts'), $general);
	    $data['IFD1.ThumbnailXResolution'] = array('IFD1.ThumbnailXResolution', $gallery->i18n('Thumbnail X Resolution'), $general);
	    $data['IFD1.ThumbnailYResolution'] = array('IFD1.ThumbnailYResolution', $gallery->i18n('Thumbnail Y Resolution'), $general);
	    $data['IFD1.PlanarConfiguration'] = array('IFD1.PlanarConfiguration', $gallery->i18n('Planar Configuration'), $general);
	    $data['IFD1.ThumbnailResolutionUnit'] = array('IFD1.ThumbnailResolutionUnit', $gallery->i18n('Thumbnail Resolution Unit'), $general);
	    $data['IFD1.JpegIFOffset'] = array('IFD1.JpegIFOffset', $gallery->i18n('Jpeg IF Offset'), $general);
	    $data['IFD1.JpegIFByteCount'] = array('IFD1.JpegIFByteCount', $gallery->i18n('Jpeg IF Byte Count'), $general);
	    $data['IFD1.YCbCrSubSampling'] = array('IFD1.YCbCrSubSampling', $gallery->i18n('Y/Cb/Cr Sub-Sampling'), $general);
	    $data['IFD1.SubfileType'] = array('IFD1.SubfileType', $gallery->i18n('Subfile Type'), $general);
	    $data['IFD1.TransferFunction'] = array('IFD1.TransferFunction', $gallery->i18n('Transfer Function'), $general);
	    $data['IFD1.Predictor'] = array('IFD1.Predictor', $gallery->i18n('Predictor'), $general);
	    $data['IFD1.TileWidth'] = array('IFD1.TileWidth', $gallery->i18n('Tile Width'), $general);
	    $data['IFD1.TileLength'] = array('IFD1.TileLength', $gallery->i18n('Tile Length'), $general);
	    $data['IFD1.TileOffsets'] = array('IFD1.TileOffsets', $gallery->i18n('Tile Offsets'), $general);
	    $data['IFD1.TileByteCounts'] = array('IFD1.TileByteCounts', $gallery->i18n('Tile Byte Counts'), $general);
	    $data['IFD1.SubIFDs'] = array('IFD1.SubIFDs', $gallery->i18n('SubIFDs'), $general);
	    $data['IFD1.JPEGTables'] = array('IFD1.JPEGTables', $gallery->i18n('JPEG Tables'), $general);
	    $data['IFD1.BatteryLevel'] = array('IFD1.BatteryLevel', $gallery->i18n('Battery Level'), $general);
	    $data['IFD1.IPTC/NAA'] = array('IFD1.IPTC/NAA', $gallery->i18n('IPTC/NAA'), $general);
	    $data['IFD1.InterColorProfile'] = array('IFD1.InterColorProfile', $gallery->i18n('Inter Color Profile'), $general);
	    $data['IFD1.Interlace'] = array('IFD1.Interlace', $gallery->i18n('Interlace'), $general);
	    $data['IFD1.TimeZoneOffset'] = array('IFD1.TimeZoneOffset', $gallery->i18n('Time Zone Offset'), $general);
	    $data['IFD1.SelfTimerMode'] = array('IFD1.SelfTimerMode', $gallery->i18n('Self Timer Mode'), $general);
	    $data['IFD1.FlashEnergy'] = array('IFD1.FlashEnergy', $gallery->i18n('Flash Energy'), $general);
	    $data['IFD1.SpatialFrequencyResponse'] = array('IFD1.SpatialFrequencyResponse', $gallery->i18n('Spatial Frequency Response'), $general);
	    $data['IFD1.Noise'] = array('IFD1.Noise', $gallery->i18n('Noise'), $general);
	    $data['IFD1.ImageNumber'] = array('IFD1.ImageNumber', $gallery->i18n('Image Number'), $general);
	    $data['IFD1.SecurityClassification'] = array('IFD1.SecurityClassification', $gallery->i18n('Security Classification'), $general);
	    $data['IFD1.SubjectLocation'] = array('IFD1.SubjectLocation', $gallery->i18n('Subject Location'), $general);
	    $data['IFD1.ExposureIndex'] = array('IFD1.ExposureIndex', $gallery->i18n('Exposure Index'), $general);
	    $data['IFD1.TIFF/EPStandardID'] = array('IFD1.TIFF/EPStandardID', $gallery->i18n('TIFF/EP Standard ID'), $general);
	    $data['IFD1.FlashEnergy'] = array('IFD1.FlashEnergy', $gallery->i18n('Flash Energy'), $general);

	    /* -- CANON -- */
	    $canon = $gallery->i18n('Canon Specific');
	    $data['Canon.Macro'] = array('SubIFD.MakerNote.Settings 1.Macro', $gallery->i18n('Macro'), $canon);
	    $data['Canon.SelfTimer'] = array('SubIFD.MakerNote.Settings 1.SelfTimer', $gallery->i18n('Self Timer'), $canon);
	    $data['Canon.Quality'] = array('SubIFD.MakerNote.Settings 1.Quality', $gallery->i18n('Quality'), $canon);
	    $data['Canon.Flash'] = array('SubIFD.MakerNote.Settings 1.Flash', $gallery->i18n('Flash'), $canon);
	    $data['Canon.DriveMode'] = array('SubIFD.MakerNote.Settings 1.DriveMode', $gallery->i18n('DriveMode'), $canon);
	    $data['Canon.FocusMode'] = array('SubIFD.MakerNote.Settings 1.FocusMode', $gallery->i18n('Focus Mode'), $canon);
	    $data['Canon.ImageSize'] = array('SubIFD.MakerNote.Settings 1.ImageSize', $gallery->i18n('Image Size'), $canon);
	    $data['Canon.EasyShooting'] = array('SubIFD.MakerNote.Settings 1.EasyShooting', $gallery->i18n('Easy Shooting'), $canon);
	    $data['Canon.Contrast'] = array('SubIFD.MakerNote.Settings 1.Contrast', $gallery->i18n('Contrast'), $canon);
	    $data['Canon.Saturation'] = array('SubIFD.MakerNote.Settings 1.Saturation', $gallery->i18n('Saturation'), $canon);
	    $data['Canon.Sharpness'] = array('SubIFD.MakerNote.Settings 1.Sharpness', $gallery->i18n('Sharpness'), $canon);
	    $data['Canon.ISO'] = array('SubIFD.MakerNote.Settings 1.ISO', $gallery->i18n('ISO'), $canon);
	    $data['Canon.MeteringMode'] = array('SubIFD.MakerNote.Settings 1.MeteringMode', $gallery->i18n('Metering Mode'), $canon);
	    $data['Canon.AFPointSelected'] = array('SubIFD.MakerNote.Settings 1.AFPointSelected', $gallery->i18n('AF Point Selected'), $canon);
	    $data['Canon.ExposureMode'] = array('SubIFD.MakerNote.Settings 1.ExposureMode', $gallery->i18n('Exposure Mode'), $canon);
	    $data['Canon.LongFocalLength'] = array('SubIFD.MakerNote.Settings 1.LongFocalLength', $gallery->i18n('Long Focal Length'), $canon);
	    $data['Canon.ShortFocalLength'] = array('SubIFD.MakerNote.Settings 1.ShortFocalLength', $gallery->i18n('Short Focal Length'), $canon);
	    $data['Canon.FocalUnits'] = array('SubIFD.MakerNote.Settings 1.FocalUnits', $gallery->i18n('Focal Units'), $canon);
	    $data['Canon.FlashDetails'] = array('SubIFD.MakerNote.Settings 1.FlashDetails', $gallery->i18n('Flash Details'), $canon);
	    $data['Canon.WhiteBalance'] = array('SubIFD.MakerNote.Settings 4.WhiteBalance', $gallery->i18n('White Balance'), $canon);
	    $data['Canon.SequenceNumber'] = array('SubIFD.MakerNote.Settings 4.SequenceNumber', $gallery->i18n('Sequence Number'), $canon);
	    $data['Canon.AFPointUsed'] = array('SubIFD.MakerNote.Settings 4.AFPointUsed', $gallery->i18n('AF Point Used'), $canon);
	    $data['Canon.FlashBias'] = array('SubIFD.MakerNote.Settings 4.FlashBias', $gallery->i18n('Flash Bias'), $canon);
	    $data['Canon.SubjectDistance'] = array('SubIFD.MakerNote.Settings 4.SubjectDistance', $gallery->i18n('Subject Distance'), $canon);
	    $data['Canon.ImageType'] = array('SubIFD.MakerNote.ImageType', $gallery->i18n('Image Type'), $canon);
	    $data['Canon.FirmwareVersion'] = array('SubIFD.MakerNote.FirmwareVersion', $gallery->i18n('Firmware Version'), $canon);
	    $data['Canon.ImageNumber'] = array('SubIFD.MakerNote.ImageNumber', $gallery->i18n('Image Number'), $canon);
	    $data['Canon.OwnerName'] = array('SubIFD.MakerNote.OwnerName', $gallery->i18n('Owner Name'), $canon);
	    $data['Canon.CameraSerialNumber'] = array('SubIFD.MakerNote.CameraSerialNumber', $gallery->i18n('Camera Serial Number'), $canon);
	    $data['Canon.CustomFunctions'] = array('SubIFD.MakerNote.CustomFunctions', $gallery->i18n('Custom Functions'), $canon);
	    
	    /* -- FUJIFILM -- */ 
	    $fujifilm = $gallery->i18n('FujiFilm Specific');
	    $data['FujiFilm.Version'] = array('SubIFD.MakerNote.Version', $gallery->i18n('Version'), $fujifilm);
	    $data['FujiFilm.Quality'] = array('SubIFD.MakerNote.Quality', $gallery->i18n('Quality'), $fujifilm);
	    $data['FujiFilm.Sharpness'] = array('SubIFD.MakerNote.Sharpness', $gallery->i18n('Sharpness'), $fujifilm);
	    $data['FujiFilm.WhiteBalance'] = array('SubIFD.MakerNote.WhiteBalance', $gallery->i18n('White Balance'), $fujifilm);
	    $data['FujiFilm.Color'] = array('SubIFD.MakerNote.Color', $gallery->i18n('Color'), $fujifilm);
	    $data['FujiFilm.Tone'] = array('SubIFD.MakerNote.Tone', $gallery->i18n('Tone'), $fujifilm);
	    $data['FujiFilm.FlashMode'] = array('SubIFD.MakerNote.FlashMode', $gallery->i18n('Flash Mode'), $fujifilm);
	    $data['FujiFilm.FlashStrength'] = array('SubIFD.MakerNote.FlashStrength', $gallery->i18n('Flash Strength'), $fujifilm);
	    $data['FujiFilm.Macro'] = array('SubIFD.MakerNote.Macro', $gallery->i18n('Macro'), $fujifilm);
	    $data['FujiFilm.FocusMode'] = array('SubIFD.MakerNote.FocusMode', $gallery->i18n('Focus Mode'), $fujifilm);
	    $data['FujiFilm.SlowSync'] = array('SubIFD.MakerNote.SlowSync', $gallery->i18n('Slow Sync'), $fujifilm);
	    $data['FujiFilm.PictureMode'] = array('SubIFD.MakerNote.PictureMode', $gallery->i18n('Picture Mode'), $fujifilm);
	    $data['FujiFilm.ContinuousTakingBracket'] = array('SubIFD.MakerNote.ContinuousTakingBracket', $gallery->i18n('Continuous Taking Bracket'), $fujifilm);
	    $data['FujiFilm.BlurWarning'] = array('SubIFD.MakerNote.BlurWarning', $gallery->i18n('Blur Warning'), $fujifilm);
	    $data['FujiFilm.FocusWarning'] = array('SubIFD.MakerNote.FocusWarning', $gallery->i18n('Focus Warning'), $fujifilm);
	    $data['FujiFilm.AEWarning'] = array('SubIFD.MakerNote.AEWarning', $gallery->i18n('AE Warning'), $fujifilm);

	    /* -- GPS -- */ 
	    $gps = $gallery->i18n('GPS Specific');
	    $data['GPS.Version'] = array('SubIFD.MakerNote.Maker.Version', $gallery->i18n('Version'), $gps);
	    $data['GPS.Reference'] = array('SubIFD.MakerNote.Latitude Reference', $gallery->i18n('Latitude Reference'), $gps);
	    $data['GPS.Latitude'] = array('SubIFD.MakerNote.Latitude', $gallery->i18n('Latitude'), $gps);
	    $data['GPS.Reference'] = array('SubIFD.MakerNote.Longitude Reference', $gallery->i18n('Longitude Reference'), $gps);
	    $data['GPS.Longitude'] = array('SubIFD.MakerNote.Longitude', $gallery->i18n('Longitude'), $gps);
	    $data['GPS.Reference'] = array('SubIFD.MakerNote.Altitude Reference', $gallery->i18n('Altitude Reference'), $gps);
	    $data['GPS.Altitude'] = array('SubIFD.MakerNote.Altitude', $gallery->i18n('Altitude'), $gps);
	    $data['GPS.Time'] = array('SubIFD.MakerNote.Time', $gallery->i18n('Time'), $gps);
	    $data['GPS.Satellite'] = array('SubIFD.MakerNote.Satellite', $gallery->i18n('Satellite'), $gps);
	    $data['GPS.ReceiveStatus'] = array('SubIFD.MakerNote.ReceiveStatus', $gallery->i18n('Receive Status'), $gps);
	    $data['GPS.MeasurementMode'] = array('SubIFD.MakerNote.MeasurementMode', $gallery->i18n('Measurement Mode'), $gps);
	    $data['GPS.MeasurementPrecision'] = array('SubIFD.MakerNote.MeasurementPrecision', $gallery->i18n('Measurement Precision'), $gps);
	    $data['GPS.SpeedUnit'] = array('SubIFD.MakerNote.SpeedUnit', $gallery->i18n('Speed Unit'), $gps);
	    $data['GPS.ReceiverSpeed'] = array('SubIFD.MakerNote.ReceiverSpeed', $gallery->i18n('Receiver Speed'), $gps);
	    $data['GPS.MovementDirectionRef'] = array('SubIFD.MakerNote.MovementDirectionRef', $gallery->i18n('Movement Direction Ref'), $gps);
	    $data['GPS.MovementDirection'] = array('SubIFD.MakerNote.MovementDirection', $gallery->i18n('Movement Direction'), $gps);
	    $data['GPS.ImageDirectionRef'] = array('SubIFD.MakerNote.ImageDirectionRef', $gallery->i18n('Image Direction Ref'), $gps);
	    $data['GPS.ImageDirection'] = array('SubIFD.MakerNote.ImageDirection', $gallery->i18n('Image Direction'), $gps);
	    $data['GPS.GeodeticSurveyData'] = array('SubIFD.MakerNote.GeodeticSurveyData', $gallery->i18n('Geodetic Survey Data'), $gps);
	    $data['GPS.DestLatitudeRef'] = array('SubIFD.MakerNote.DestLatitudeRef', $gallery->i18n('Dest Latitude Ref'), $gps);
	    $data['GPS.DestinationLatitude'] = array('SubIFD.MakerNote.DestinationLatitude', $gallery->i18n('Destination Latitude'), $gps);
	    $data['GPS.DestLongitudeRef'] = array('SubIFD.MakerNote.DestLongitudeRef', $gallery->i18n('Dest Longitude Ref'), $gps);
	    $data['GPS.DestinationLongitude'] = array('SubIFD.MakerNote.DestinationLongitude', $gallery->i18n('Destination Longitude'), $gps);
	    $data['GPS.DestBearingRef'] = array('SubIFD.MakerNote.DestBearingRef', $gallery->i18n('Dest Bearing Ref'), $gps);
	    $data['GPS.DestinationBearing'] = array('SubIFD.MakerNote.DestinationBearing', $gallery->i18n('Destination Bearing'), $gps);
	    $data['GPS.DestDistanceRef'] = array('SubIFD.MakerNote.DestDistanceRef', $gallery->i18n('Dest Distance Ref'), $gps);
	    $data['GPS.DestinationDistance'] = array('SubIFD.MakerNote.DestinationDistance', $gallery->i18n('Destination Distance'), $gps);
	    $data['GPS.ProcessingMethod'] = array('SubIFD.MakerNote.ProcessingMethod', $gallery->i18n('Processing Method'), $gps);
	    $data['GPS.AreaInformation'] = array('SubIFD.MakerNote.AreaInformation', $gallery->i18n('Area Information'), $gps);
	    $data['GPS.Datestamp'] = array('SubIFD.MakerNote.Datestamp', $gallery->i18n('Datestamp'), $gps);
	    $data['GPS.DifferentialCorrection'] = array('SubIFD.MakerNote.DifferentialCorrection', $gallery->i18n('Differential Correction'), $gps);
	    
	    /* -- NIKON -- */ 
	    $nikon = $gallery->i18n('Nikon Specific');
	    $data['Nikon.Quality'] = array('SubIFD.MakerNote.Quality', $gallery->i18n('Quality'), $nikon);
	    $data['Nikon.ColorMode'] = array('SubIFD.MakerNote.ColorMode', $gallery->i18n('Color Mode'), $nikon);
	    $data['Nikon.ImageAdjustment'] = array('SubIFD.MakerNote.ImageAdjustment', $gallery->i18n('Image Adjustment'), $nikon);
	    $data['Nikon.CCDSensitivity'] = array('SubIFD.MakerNote.CCDSensitivity', $gallery->i18n('CCD Sensitivity'), $nikon);
	    $data['Nikon.WhiteBalance'] = array('SubIFD.MakerNote.WhiteBalance', $gallery->i18n('White Balance'), $nikon);
	    $data['Nikon.Focus'] = array('SubIFD.MakerNote.Focus', $gallery->i18n('Focus'), $nikon);
	    $data['Nikon.DigitalZoom'] = array('SubIFD.MakerNote.DigitalZoom', $gallery->i18n('Digital Zoom'), $nikon);
	    $data['Nikon.Converter'] = array('SubIFD.MakerNote.Converter', $gallery->i18n('Converter'), $nikon);
	    $data['Nikon.ISOSetting'] = array('SubIFD.MakerNote.ISOSetting', $gallery->i18n('ISO Setting'), $nikon);
	    $data['Nikon.ColorMode'] = array('SubIFD.MakerNote.ColorMode', $gallery->i18n('Color Mode'), $nikon);
	    $data['Nikon.Quality'] = array('SubIFD.MakerNote.Quality', $gallery->i18n('Quality'), $nikon);
	    $data['Nikon.ImageSharpening'] = array('SubIFD.MakerNote.ImageSharpening', $gallery->i18n('Image Sharpening'), $nikon);
	    $data['Nikon.FocusMode'] = array('SubIFD.MakerNote.FocusMode', $gallery->i18n('Focus Mode'), $nikon);
	    $data['Nikon.FlashSetting'] = array('SubIFD.MakerNote.FlashSetting', $gallery->i18n('Flash Setting'), $nikon);
	    $data['Nikon.ISOSelection'] = array('SubIFD.MakerNote.ISOSelection', $gallery->i18n('ISO Selection'), $nikon);
	    $data['Nikon.ImageAdjustment'] = array('SubIFD.MakerNote.ImageAdjustment', $gallery->i18n('Image Adjustment'), $nikon);
	    $data['Nikon.Adapter'] = array('SubIFD.MakerNote.Adapter', $gallery->i18n('Adapter'), $nikon);
	    $data['Nikon.ManualFocusDistance'] = array('SubIFD.MakerNote.ManualFocusDistance', $gallery->i18n('Manual Focus Distance'), $nikon);
	    $data['Nikon.DigitalZoom'] = array('SubIFD.MakerNote.DigitalZoom', $gallery->i18n('Digital Zoom'), $nikon);
	    $data['Nikon.AFFocusPosition'] = array('SubIFD.MakerNote.AFFocusPosition', $gallery->i18n('AF Focus Position'), $nikon);
	    $data['Nikon.Saturation'] = array('SubIFD.MakerNote.Saturation', $gallery->i18n('Saturation'), $nikon);
	    $data['Nikon.NoiseReduction'] = array('SubIFD.MakerNote.NoiseReduction', $gallery->i18n('Noise Reduction'), $nikon);
	    
	    /* -- OLYMPUS -- */ 
	    $olympus = $gallery->i18n('Olympus Specific');
	    $data['Olympus.SpecialMode'] = array('SubIFD.MakerNote.SpecialMode', $gallery->i18n('Special Mode'), $olympus);
	    $data['Olympus.JpegQual'] = array('SubIFD.MakerNote.JpegQual', $gallery->i18n('Jpeg Quality'), $olympus);
	    $data['Olympus.Macro'] = array('SubIFD.MakerNote.Macro', $gallery->i18n('Macro'), $olympus);
	    $data['Olympus.DigiZoom'] = array('SubIFD.MakerNote.DigiZoom', $gallery->i18n('DigiZoom'), $olympus);
	    $data['Olympus.SoftwareRelease'] = array('SubIFD.MakerNote.SoftwareRelease', $gallery->i18n('Software Release'), $olympus);
	    $data['Olympus.PictInfo'] = array('SubIFD.MakerNote.PictInfo', $gallery->i18n('Picture Info'), $olympus);
	    $data['Olympus.CameraID'] = array('SubIFD.MakerNote.CameraID', $gallery->i18n('Camera ID'), $olympus);

	    /* -- SANYO -- */ 
	    $sanyo = $gallery->i18n('Sanyo Specific');
	    $data['Sanyo.SpecialMode'] = array('SubIFD.MakerNote.SpecialMode', $gallery->i18n('Special Mode'), $sanyo);
	    $data['Sanyo.Quality'] = array('SubIFD.MakerNote.Quality', $gallery->i18n('Quality'), $sanyo);
	    $data['Sanyo.Macro'] = array('SubIFD.MakerNote.Macro', $gallery->i18n('Macro'), $sanyo);
	    $data['Sanyo.DigiZoom'] = array('SubIFD.MakerNote.DigiZoom', $gallery->i18n('DigiZoom'), $sanyo);

	    /*
	     * keys that don't appear to be used in any sample images that I have available to me:
	     *
	     * SubIFD.CFAPattern, IFD1.CFAPattern, IFD1.CFARepeatPatternDim, IFD1.OECF
	     */
	}
	return $data;
    }
}