<?php

class CreateAlbumItemTestCase extends TestCase {

    function getDescription() {
	return "Create a new AlbumItem, save it, modify it, save it again";
    }

    function testStart() {
	global $gallery;

	print("Creating new album item\n");
	$album = new GalleryAlbumItem();
	$ret = $album->createRoot("test", $gallery->getActiveUserId());
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}

	$album->setRows(3);
	$album->setDescription("This is a longish description with " .
				     "+=!@#$%^&*()_-|\\\"'?/>.<,}]{[~` chars in it");

	print("SAVE\n");
	$ret = $album->save();
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}

	print("ASSIGN PERMISSIONS\n");
	/* Give all users some stuff */
	$groupId = $gallery->getConfig('core.id.allUserGroup');
	foreach (array(PERMISSION_VIEW,
		       PERMISSION_VIEW_RESIZES) as $permission) {
	    $ret = GalleryPermissionMap::addGroupPermission($album->getId(),
							    $groupId,
							    $permission);
	    if ($ret->isError()) {
		return $ret->wrap(__FILE__, __LINE__);
	    }
	}

	/* Grant admin users everything */
	$groupId = $gallery->getConfig('core.id.adminGroup');
	$ret = GalleryPermissionMap::addGroupPermission($album->getId(),
							$groupId,
							PERMISSION_ALL);
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}
	
	return GalleryStatus::success();
    }
}

?>
