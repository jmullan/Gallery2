<?php

class CreateAlbumItemTestCase extends TestCase {

    var $_item;

    function getDescription() {
	return "Create a new AlbumItem, save it, modify it, save it again";
    }

    function testStart() {
	$this->_item = new AlbumItem();

	print("Creating new album item\n");
	$ret = $this->_item->createRoot("test");
	$this->dump($ret, $this->_item);

	if ($ret->isError()) {
	    $this->error($ret);
	    $this->_item = null;
	    return $ret;
	}
	
	print("SAVE\n");
	$ret = $this->_item->save();
	$this->dump($ret, $this->_item);
	if ($ret->isError()) {
	    $this->error($ret);
	    return $ret;
	}

	global $gallery;
	$ret = $gallery->lockLocal(array($this->_item->getId()));
	if ($ret->isError()) {
	    $this->error($ret);
	    return $ret;
	}

	$this->_item->setRows(3);
	$childIds =& $this->_item->getChildIds();
	$childIds->push(3);
	$childIds->unshift(5);
	print("SECOND SAVE\n");
	$ret = $this->_item->save();
	$this->dump($ret, $this->_item);
	if ($ret->isError()) {
	    $this->error($ret);
	    return $ret;
	}
	
	$this->_item->setRows(0);
	$this->_item->setDescription("This is a longish description with " .
				     "+=!@#$%^&*()_-|\\\"'?/>.<,}]{[~` chars in it");
	print("THIRD SAVE\n");
	$ret = $this->_item->save();
	$this->dump($ret, $this->_item);
	if ($ret->isError()) {
	    $this->error($ret);
	    return $ret;
	}

	return GalleryStatus::success();
    }
}

?>
</pre>
