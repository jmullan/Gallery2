<?php

class CreateAndDeleteAlbumItemTestCase extends TestCase {

    function getDescription() {
	return "Create a new AlbumItem and then delete it";
    }

    function testStart() {
	global $gallery;

	print("Creating new album item\n");
	$album = new AlbumItem();
	$ret = $album->createRoot("createAndDelete",
				  $gallery->getActiveUserId());
	
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}

	$ret = $gallery->lockWorld();
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}

	/* Add some properties */
	$properties =& $album->getProperties();
	$properties->set('banana', 'orange');
	$properties->set('look at me', serialize($this));
	$properties->set('password', md5('banana'));
	
	print("SAVE\n");
	$ret = $album->save();
	if ($ret->isError()) {
	    $this->error($ret);
	    return $ret->wrap(__FILE__, __LINE__);
	}

	$ret = $gallery->commitCache();
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}

	print("DELETE\n");
	$ret = $album->delete();
	if ($ret->isError()) {
	    $this->error($ret);
	    return $ret->wrap(__FILE__, __LINE__);
	}

	$ret = $gallery->commitCache();
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}

	/* Leggo of our locks */
	$ret = $gallery->unlock();
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}
	
	return GalleryStatus::success();
    }
}

?>
</pre>
