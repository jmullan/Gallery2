<?php

class CreateGroupAndUsersTestCase extends TestCase {

    function getDescription() {
	return "Create new Group and Users, test adding and removing Users from Groups";
    }

    function testStart() {
	global $gallery;

	$group = new GalleryGroup();
	$ret = $group->create();
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}
	$group->setGroupName('Group 1');
	$ret = $group->save();
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}

	$user1 = new GalleryUser();
	$ret = $user1->create();
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}

	$user1->setFullName('User 1');
	$user1->setUsername('user1');
	$user1->changePassword('password');
	$user1->setEmail('User1@gallery.com');
	$user1->setIsAdmin(false);
	print_r($user1);
	$ret = $user1->save();
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}
	
	$user2 = new GalleryUser();
	$ret = $user2->create();
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}
	$user2->setFullName('User 2');
	$user1->setUsername('user2');
	$user2->changePassword('password');
	$user2->setEmail('User2@gallery.com');
	$user2->setIsAdmin(false);
	$ret = $user2->save();
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}

	print "<h2>ADD USERS TO GROUP!</h2>";
	$ret = GalleryUserGroupMap::addUserToGroup($user1->getId(),
						   $group->getId());
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}

	$ret = GalleryUserGroupMap::addUserToGroup($user2->getId(),
						   $group->getId());
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}

	print "<h2>REMOVE!</h2>";
	$ret = GalleryUserGroupMap::removeUserFromGroup($user1->getId(),
							$group->getId());
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}

	return GalleryStatus::success();
    }
}

?>

