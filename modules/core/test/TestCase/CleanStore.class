<?php

/**
 * @version $Revision$ $Date$
 * @package GalleryCore
 * @subpackage TestCase
 * @author Bharat Mediratta <bharat@menalto.com>
 */

/**
 * @package GalleryCore
 * @subpackage TestCase
 */
class CleanStoreTestCase extends TestCase {

    function getDescription() {
	global $gallery;
	$config = $gallery->getConfig('storage.config');
	return 'Reset the G2 database called "' . $config['database']
	     . '" with table prefix "' . $config['tablePrefix'] . '"';
    }

    function testStart() {
	global $gallery;

	$storage =& $gallery->getStorage();
	$ret = $storage->cleanStore();
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}

	/* Reset our caches */
	GalleryDataCache::reset();
	GalleryCoreApi::relativeRequireOnce(
	    'modules/core/classes/helpers/GalleryEventHelper_simple.class');
	$eventListeners =& GalleryEventHelper_simple::_getEventListeners();
	$eventListeners = array();

	return GalleryStatus::success();
    }
}

?>
