<?php

/**
 * @version $Revision$ $Date$
 * @package GalleryCore
 * @subpackage TestCase
 * @author Bharat Mediratta <bharat@menalto.com>
 */

/**
 * @package GalleryCore
 * @subpackage TestCase
 */
class FlushCacheTestCase extends TestCase {

    function getDescription() {
	return "Get rid of all cached entities";
    }

    function testStart() {
	global $gallery;

	$platform = $gallery->getPlatform();

	$dirs = array();
	foreach (array('cache') as $param) {
	    $dir = $gallery->getConfig('data.gallery.base') . '/' . $param;
	    if (!empty($dir)) {
		$dirs[] = $dir;
	    }
	}

	foreach ($dirs as $dir) {

	    if (empty($dir)) {
		return GalleryStatus::error(ERROR_BAD_PATH, __FILE__, __LINE__);
	    }

	    if ($platform->file_exists($dir)) {
		$ret = $platform->recursiveRmdir($dir);
		if (!$ret) {
		    return GalleryStatus::error(ERROR_BAD_PATH, __FILE__, __LINE__);
		}
	    }

	    $ret = $platform->mkdir($dir);
	    if (!$ret) {
		return GalleryStatus::error(ERROR_BAD_PATH, __FILE__, __LINE__);
	    }
	}

	return GalleryStatus::success();
    }
}
?>
