<?php

class DeleteAllItemsTestCase extends TestCase {

    function getIterations() {
	return array(1);
    }

    function getDescription() {
	return "Delete all items in the database, one by one";
    }

    function testStart() {
	global $gallery;

	while (true) {
	    $gallery->setTimeLimit(60);
	    
	    list ($ret, $results) =
		$gallery->search(array('select' => '[GalleryEntity::id]',
				       'where' => '[GalleryEntity::entityType]=?',
				       'order-by' => '[GalleryEntity::id] DESC',
				       'limit' => array('offset' => 0, 'count' => 5)),
				 array('GalleryAlbumItem'));
	    if ($ret->isError()) {
		return $ret->wrap(__FILE__, __LINE__);
	    }

	    if ($results->resultCount() == 0) {
		break;
	    }

	    while ($result = $results->nextResult()) {
		$id = $result[0];
		$ret = $gallery->deleteEntityById($id);
		if ($ret->isError()) {
		    return $ret->wrap(__FILE__, __LINE__);
		}
	    }
	}

	return GalleryStatus::success();
    }
}

?>

