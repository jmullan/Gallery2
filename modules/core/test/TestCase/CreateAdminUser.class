<?php

class CreateAdminUserTestCase extends TestCase {

    function getDescription() {
	return "Create the Admin user";
    }

    function testStart() {
	global $gallery;

	/* Create the user */
	list ($ret, $user) = $gallery->newEntity('GalleryUser');
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}

	$ret = $user->create('admin');
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}
	$user->changePassword('admin');
	$user->setFullName('Admin');
	
	$ret = $user->save();
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}

	list ($ret, $adminGroupId) =
	    $gallery->getModuleParameter('core', 'id.adminGroup');
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}

	/* Add her to the admin group */
	$ret = GalleryUserGroupMap::addUserToGroup($user->getId(),
						   $adminGroupId);
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}

	return GalleryStatus::success();
    }
}

?>
