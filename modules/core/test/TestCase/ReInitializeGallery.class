<?php

/**
 * @version $Revision$ $Date$
 * @package GalleryCore
 * @subpackage TestCase
 * @author Bharat Mediratta <bharat@menalto.com>
 */

/**
 * @package GalleryCore
 * @subpackage TestCase
 */
class ReInitializeGalleryTestCase extends TestCase {

    function getDescription() {
	return 'Reset the database and the gallery data area.  ' .
		'Create root album, anonymous user.';
    }

    function getDependencies() {
	global $gallery;
	
	$dependencies = array(array('moduleId' => 'core', 'testName' => 'ResetGallery'),
			      array('moduleId' => 'core', 'testName' => 'InitializeGallery'),
			      array('moduleId' => 'debug', 'testName' => 'ActivateModule'),
			      array('moduleId' => 'imageblock', 'testName' => 'InstallModule'),
			      array('moduleId' => 'imageblock', 'testName' => 'ActivateModule'),
			      );

	return $dependencies;
    }

    function testStart() {
	global $gallery;

	/* Log in as the admin user */
	list ($ret, $adminUser) = GalleryCoreApi::loadEntitiesById(5);
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}
	
	$gallery->setActiveUser($adminUser);

	$session =& $gallery->getSession();
	$ret = $session->save();
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}
	
	return GalleryStatus::success();
    }
}

?>
