<?php

class CreateGalleryCommentTestCase extends TestCase {

    function getDescription() {
	return "Create a new comment attached to the root album";
    }

    function testStart() {
	global $gallery;
	$rootId = $gallery->getRootAlbumId();

	/* Lock the world */
	$ret = $gallery->lockWorld();
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}

	/* Create our child */
	$comment = new GalleryComment();
	$ret = $comment->create($rootId);
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}
	
	/* Make a change */
	$comment->setEmailAddress('bozo@slashdot.org');
	$comment->setComment('Weirdolet writes: "Ananova are reporting that ultra-dense, pollen sized strangelets (aka nuggets of strange quarks) travelling at 900,000 miles per hour hit the earth, violently pass through it and have done on at least two occasions already. It\'s also reported, allegedly, in the Sunday telegraph but I haven\'t found it there yet :P Coming to a particle accelerator near you soon ... ?" Another reader has found the story at the Telegraph.');
	$comment->setDate(time());
	$comment->setHostname('www.slashdot.org');
	$comment->setName('Cmdr Taco');
	
	/* Commit the cache */
	$ret = $gallery->commitCache();
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}

	/* Unlock the world */
	$ret = $gallery->unlock();
	if ($ret->isError()) {
	    return $ret->wrap(__FILE__, __LINE__);
	}

	return GalleryStatus::success();
    }
}

?>
